"""
WebShare 代理配置和管理
"""
import os
import random

# WebShare 憑證
WEBSHARE_USERNAME = os.environ.get('WEBSHARE_USERNAME', 'ellpsmsi')
WEBSHARE_PASSWORD = os.environ.get('WEBSHARE_PASSWORD', '5x76u62w6hou')

# 代理 IP 列表
# 可以透過環境變數 PROXY_IPS 設定(逗號分隔)
# 例如: PROXY_IPS="23.94.138.113:6387,192.241.104.29:8123,..."
DEFAULT_PROXY_IPS = [
    '23.94.138.113:6387',
'192.241.104.29:8123',
'82.27.216.28:5359',
'191.101.181.5:6758',
'66.63.180.38:5562',
'92.113.119.149:6097',
'31.57.82.19:6600',
'82.22.233.111:6933',
'107.174.25.9:5463',
'23.236.222.234:7265',
'104.253.180.235:6648',
'45.91.167.171:6730',
'82.25.235.106:7457',
'216.74.115.100:6694',
'38.154.194.19:9432',
'77.83.233.213:6831',
'92.112.175.163:6436',
'92.112.238.213:7092',
'161.123.115.147:5168',
'204.217.245.198:6789',
'173.211.8.140:6252',
'136.0.188.248:6211',
'38.170.176.156:5551',
'166.88.3.247:6718',
'185.72.241.141:7433',
'216.173.74.81:5761',
'23.229.125.218:5487',
'173.211.0.132:6625',
'184.174.25.93:5982',
'136.0.117.237:6975',
'185.198.37.126:5813',
'45.41.173.240:6607',
'104.168.8.228:5681',
'23.26.231.4:7245',
'23.109.232.121:6041',
'92.113.83.31:5976',
'142.111.58.113:6691',
'193.25.167.49:5580',
'107.174.128.150:6592',
'67.227.36.213:6255',
'82.22.234.44:7894',
'92.112.174.126:5710',
'185.135.10.178:5692',
'23.229.110.213:8741',
'142.202.255.144:6384',
'38.153.135.231:5611',
'198.89.123.65:6607',
'82.21.209.167:6496',
'107.172.163.73:6589',
'166.88.217.69:6402',
'64.188.120.228:7975',
'104.253.180.35:6448',
'192.186.186.106:6148',
'104.238.37.213:6770',
'184.174.58.145:5707',
'45.61.98.33:5717',
'50.114.84.150:7389',
'217.198.177.215:5731',
'31.58.9.204:6277',
'161.123.154.161:6691',
'198.23.239.164:6570',
'172.245.158.99:6052',
'104.253.77.96:5518',
'45.41.178.36:6257',
'82.22.214.102:5954',
'104.168.118.57:6013',
'166.88.217.15:6348',
'194.38.18.75:7137',
'145.223.54.18:5983',
'185.72.241.189:7481',
'45.61.96.66:6046',
'91.223.126.131:6743',
'104.168.118.209:6165',
'104.239.35.114:5796',
'66.63.180.252:5776',
'166.88.238.215:6195',
'82.27.247.152:5486',
'86.38.26.226:6391',
'154.6.115.138:6607',
'45.150.176.32:5905',
'77.81.103.67:5584',
'91.198.95.81:5603',
'82.24.242.58:7877',
'104.252.109.7:6940',
'108.165.205.199:5436',
'45.61.97.118:6644',
'45.83.59.235:7251',
'198.23.147.25:5040',
'209.242.203.99:6814',
'136.0.103.144:5845',
'154.29.232.109:6769',
'198.105.122.77:6650',
'45.61.123.99:5778',
'82.24.242.119:7938',
'142.147.128.41:6541',
'94.176.212.241:6757',
'140.99.207.230:5607',
'38.170.157.129:9168',
'59.152.60.203:6143',
'104.252.109.21:6954',
]

# 從環境變數讀取,如果沒有則使用預設值
PROXY_IPS_STR = os.environ.get('PROXY_IPS', ','.join(DEFAULT_PROXY_IPS))
PROXY_IPS = [ip.strip() for ip in PROXY_IPS_STR.split(',') if ip.strip()]

def get_random_proxy():
    """隨機選擇一個代理並返回完整的代理 URL"""
    if not PROXY_IPS:
        return None
    
    proxy_ip = random.choice(PROXY_IPS)
    proxy_url = f"http://{WEBSHARE_USERNAME}:{WEBSHARE_PASSWORD}@{proxy_ip}"
    return proxy_url

def get_proxy_display(proxy_url):
    """取得代理的顯示名稱(隱藏密碼)"""
    if not proxy_url:
        return "無代理"
    
    if '@' in proxy_url:
        return proxy_url.split('@')[1]
    return proxy_url

# 啟動時顯示代理資訊
if PROXY_IPS:
    print(f"🔒 WebShare 代理池已載入: {len(PROXY_IPS)} 個代理")
    print(f"📋 代理列表: {', '.join(PROXY_IPS[:5])}{'...' if len(PROXY_IPS) > 5 else ''}")
else:
    print("⚠️ 未設定代理")
