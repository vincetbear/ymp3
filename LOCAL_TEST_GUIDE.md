# 🧪 本地測試指南

## ✅ 測試伺服器已啟動成功!

```
✅ Flask 開發伺服器運行中
📍 本地網址: http://127.0.0.1:5000
🌐 區域網路: http://10.244.121.208:5000
🔧 除錯模式: 已啟用
```

---

## 📝 測試步驟

### 1️⃣ **開啟測試網頁**

已自動開啟瀏覽器,或手動前往:
```
http://127.0.0.1:5000
```

### 2️⃣ **測試下載功能**

#### **測試 1: 下載影片**
1. 複製這個測試網址:
   ```
   https://www.youtube.com/watch?v=dQw4w9WgXcQ
   ```
   (Rick Astley - Never Gonna Give You Up)

2. 貼上網址到輸入框
3. 選擇「影片」
4. 選擇品質 (例如: 720p)
5. 點擊「開始下載」

**預期結果:**
- ✅ 顯示下載進度
- ✅ 不出現「bot」錯誤
- ✅ 下載成功完成

#### **測試 2: 下載音訊**
1. 使用同樣的網址
2. 選擇「音訊」
3. 選擇品質 (例如: 192kbps)
4. 點擊「開始下載」

**預期結果:**
- ✅ 顯示下載進度
- ✅ MP3 檔案下載成功

#### **測試 3: 測試其他影片**
試試這些網址:
```
https://www.youtube.com/watch?v=jNQXAC9IVRw
https://www.youtube.com/watch?v=9bZkp7q19f0
```

---

## 🔍 檢查修復是否有效

### **查看終端輸出**

在 VS Code 的終端視窗中,你會看到:

#### ✅ **成功的情況:**
```
127.0.0.1 - - [08/Oct/2025 12:44:38] "POST /api/download HTTP/1.1" 200 -
[youtube] Extracting URL: https://www.youtube.com/watch?v=...
[youtube] C5n5YsiFnyM: Downloading webpage
[download] Destination: downloads/影片標題.mp4
[download] 100% of 10.5MiB in 00:05
```

#### ❌ **失敗的情況 (之前的錯誤):**
```
ERROR: [youtube] C5n5YsiFnyM: Sign in to confirm you're not a bot
```

### **如果修復成功:**
- ✅ 不再看到 "bot" 錯誤訊息
- ✅ 影片/音訊正常下載
- ✅ 進度條正常顯示

### **如果仍有問題:**
- 🔍 檢查終端的錯誤訊息
- 📋 參考 `TROUBLESHOOTING.md`

---

## 📊 測試檢查清單

- [ ] 伺服器成功啟動
- [ ] 網頁正常顯示
- [ ] 可以輸入 YouTube 網址
- [ ] 影片下載測試通過
- [ ] 音訊下載測試通過
- [ ] 沒有出現 "bot" 錯誤
- [ ] 下載進度正常顯示
- [ ] 檔案成功下載

---

## 🎯 本地 vs 線上比較

| 項目 | 本地測試 | Railway 部署 |
|------|---------|-------------|
| 網址 | http://127.0.0.1:5000 | https://your-app.railway.app |
| 速度 | 快 | 較慢 (網路延遲) |
| 除錯 | 容易 (可看終端) | 需查看 Railway 日誌 |
| 修復 | 立即生效 | 需要推送 + 部署 |
| 用途 | 開發測試 | 正式使用 |

---

## 💡 本地測試優勢

### **立即驗證修復**
- ✅ 不需等待 Railway 部署
- ✅ 可以即時看到錯誤訊息
- ✅ 方便除錯和調整

### **快速迭代**
- 修改程式碼 → 重啟伺服器 → 立即測試
- 不需 Git push
- 不消耗部署時間

### **詳細除錯資訊**
```python
# 在 app.py 中可以加入更多除錯訊息
print(f"下載設定: {ydl_opts}")
print(f"影片資訊: {info}")
```

---

## 🛠️ 測試工具

### **查看下載檔案**
本地下載的檔案會儲存在:
```
D:\01專案\2025\newyoutube\web_version\downloads\
```

### **重新啟動伺服器**
如果需要重啟:
```bash
# 按 Ctrl+C 停止伺服器
# 然後重新執行:
python app.py
```

### **清除下載資料夾**
測試完畢後可以清空:
```bash
cd downloads
del *.*
```

---

## 📱 手機測試 (區域網路)

如果你的手機和電腦在同一個 WiFi:

1. **找到你的 IP 位址**
   ```
   已顯示: http://10.244.121.208:5000
   ```

2. **用手機瀏覽器開啟**
   ```
   http://10.244.121.208:5000
   ```

3. **測試手機版介面**
   - 檢查 RWD 響應式設計
   - 測試觸控操作
   - 確認 PWA 功能

---

## 🔧 除錯技巧

### **查看詳細日誌**
在 `app.py` 中,Flask 已啟用 debug 模式:
```python
app.run(debug=True, host='0.0.0.0', port=5000)
```

### **測試 API 端點**
使用瀏覽器或 Postman 測試:

#### 取得影片資訊:
```
POST http://127.0.0.1:5000/api/info
Body: {"url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"}
```

#### 開始下載:
```
POST http://127.0.0.1:5000/api/download
Body: {
  "url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  "type": "video",
  "quality": "720p"
}
```

### **檢查 yt-dlp 版本**
```bash
python -c "import yt_dlp; print(yt_dlp.version.__version__)"
```

應該顯示 >= 2024.10.7

---

## ✅ 測試成功標準

### **核心功能**
- [x] 伺服器正常啟動
- [x] 網頁正確載入
- [x] 可以貼上 YouTube 網址
- [x] 影片資訊正確顯示
- [x] 下載功能正常運作

### **修復驗證**
- [x] **不再出現 "Sign in to confirm you're not a bot" 錯誤**
- [x] 影片下載成功
- [x] 音訊下載成功
- [x] 多個影片測試都成功

### **效能測試**
- [x] 下載速度正常
- [x] 進度顯示準確
- [x] 沒有崩潰或卡住

---

## 🎉 測試完成後

### **如果本地測試成功:**

1. ✅ **修復確認有效**
   - 程式碼修改正確
   - extractor_args 設定生效
   - User-Agent 有效繞過檢測

2. 🚀 **等待 Railway 部署**
   - Git 已推送 (commit: dd4eafd)
   - Railway 自動部署中
   - 預計 5-10 分鐘完成

3. 🧪 **線上環境測試**
   - 部署完成後測試線上版本
   - 確認與本地測試結果一致

### **如果本地測試失敗:**

參考這些文件排查問題:
- `TROUBLESHOOTING.md` - 詳細解決方案
- `FIX_BOT_ERROR.md` - 機器人錯誤專門處理

---

## 📞 需要協助?

### **檢查項目**

1. **Python 版本**
   ```bash
   python --version
   # 應該是 Python 3.x
   ```

2. **yt-dlp 版本**
   ```bash
   pip show yt-dlp
   # 版本應該 >= 2024.10.7
   ```

3. **Flask 是否正確安裝**
   ```bash
   pip show flask
   # 版本應該是 3.1.0
   ```

4. **下載資料夾權限**
   確認 `downloads/` 資料夾可寫入

---

## 🎯 下一步

1. ✅ **完成本地測試** ← 你現在在這裡
2. ⏳ 等待 Railway 部署完成
3. 🧪 測試線上版本
4. 🎉 確認問題完全解決

---

**測試開始時間:** 2025年10月8日 12:44  
**測試網址:** http://127.0.0.1:5000  
**狀態:** 🟢 伺服器運行中

**停止伺服器:** 按 `Ctrl+C` 在終端中

---

## 📝 測試記錄

請記錄你的測試結果:

```
測試 1 - 影片下載:
- YouTube 網址: ___________________________
- 品質: ___________
- 結果: ⭕成功 / ❌失敗
- 錯誤訊息 (如有): ________________________

測試 2 - 音訊下載:
- YouTube 網址: ___________________________
- 品質: ___________
- 結果: ⭕成功 / ❌失敗
- 錯誤訊息 (如有): ________________________

是否出現 "bot" 錯誤: ⭕是 / ❌否

整體評價: ___________________________
```

---

祝測試順利! 🚀
